---
published: true
categories: technique
tags: router repeater
---
今天说个技术点的话题。

这两天房东家的wifi信号是越来越微弱了，不知道是不是由于天气太寒冷的原因，之前想到的做路由器中继的路子趁着这两天圣诞假期开始搞我从国内带过来的Cisco E3200（之前在上海用它用了7年，到加拿大继续发挥余热），费了半天事，终于成功了，趁热记录一下。

## 概念
首先要搞清楚几个概念，WDS， 中继(repeator)，桥接之类的，很容易晕晕乎乎。 知乎上有个总结很好的[帖子](https://www.zhihu.com/question/20380724)，引用如下：
>为了论述方便，先假定有两个无线路由器，分别是 R1 和 R2，R1 的 WAN 口具有 Internet 连接并且工作在 AP 模式，R2 通过无线模块和 R1 相连。**Client**： (客户端)R2 的无线口是 R1 的客户，此时 R2 无 AP 功能，R2 工作在路由（三层）方式，R1 和 R2 分属不同 IP 网段，确切地说它们在不同的冲突域中。**Client Bridge**:（客户端桥接）R2 的无线口是 R1 的客户，此时 R2 无 AP 功能，但 R2 工作在桥接（二层）方式， 可以将 R1 和 R2 置于同一 IP 网段，确切说它们位于同一冲突域。**WDS**：
特殊的桥接方式， 必须修改 R1 的配置，让其工作在 AP+WDS 模式下， R2 才能使用 WDS 与之相连，同时 R2 也能作为 AP。同样可以将 R1 和 R2 置于同一 IP 网段，确切说它们位于同一冲突域。**Repeater**: （中继）
类似 Client，但同时还能用做 AP。Repeater Bridge: （中继桥接）
类似 Client Bridge, 但同时还能做 AP

对于DD-WRT系统的几个模式，也是在这个贴子里，解释的很好。
>1. 访问点 (AP)该模式下路由器的无线网卡就像一个”无线HUB”，负责建立无线路由器和电脑之间的数据链路（相当于无形的网线）。正常情况下，家用的无线路由器的无线连接都默认工作在此模式下。
>2. 客户端 (Client)像笔记本电脑上的无线网卡那样工作，仅连接其它的无线网络，而不发射自己的无线网络信号。对于无线路由器来说，这种模式相当于启用了一个无线的WAN口，且下面的电脑只能通过有线方式接到此设备。该模式下无线路由器仍然提供DHCP及NAT功能，内部四个LAN口组成的单独IP地址段局域网，通过无线路由器上自己的网关，连上外部主网络。
>3. 客户端网桥 (Client Bridge)和“客户端”模式一样，相当于启用了一个无线的WAN口，且下面的电脑只能通过有线方式接到此设备。不过，内部的LAN口组成的局域网和连接上的无线网段处于相同的IP地址段。内部的DHCP请求也会被转发到主无线网络上。
>4. AdhocAdhoc有个形象的比喻，就像是将两台电脑之间直接找根网线连起来，只不过在这里这根网线是个无线的。最常见的使用adhoc连接的设备多数是一些手持游戏机。该模式在无线路由器上使用的场合比较罕见。
>5. 中继 (Repeater)顾名思义，中继就是一边是接受信号，一边又发射自己的无线信号。在这种模式下无线路由器以无线网卡客户身份接入主AP，然后再以新增虚拟界面(Virtual Interfaces)来为客户端提供无线接入。该模式的最大意义在于可以解决无线信号受到距离或者障碍物的影响不能传输到更远的问题。这种模式下无线路由器仍然提供DHCP及NAT功能，即所有的内部LAN口以及无线客户接入组成的是一个单独的局域网网段。
>6. 中继桥接 (Repeater Bridge)和”中继”模式一样，可以解决无线信号受到距离或者障碍物的影响不能传输到更远的问题。不过，接入到该无线路由器上的电脑终端，是和主无线网网络处在相同的IP地址段。内部的DHCP请求，也会被转发到主无线网络上。

## 需求
我需要在不更改原有房东的路由器的情况下，把原来的信号用无线的方式接受后再放大。根据概念节的描述，我应该使用中继（repeater），或者中继桥接（repeator bridge），因为WDS要求对房东家的路由器做更改，这显然不能。而client的模式根本就不支持无线信号发送。处于安全性考虑，决定使用中继模式（repeator）,其实，这里对repeating mode 有个很好的[比较](https://www.dd-wrt.com/wiki/index.php/Repeating_Mode_Comparisons)。可惜我我不是一开始知道这个事情，导致我白白在原生系统和Tomato系统上浪费了半天时间，为了完整，也对这两者略作描述。

## E3200 原生系统
一开始想使用原生的Cicso/Linksys E3200系统来搞，发现它不支持无线中继，只支持[Cascacding LAN](https://www.linksys.com/us/support-article?articleNum=132275)，而这个必须要用网线。 只能放弃，本来想再买个路由器，忽然想起可以刷路由器固件。。嘿嘿嘿，折腾之路正式开始。

## Tomato
这个系统在路由器刷机界顶多排名第二第三，另外还有扛把子DD-WRT和openwrt，当时图方便，就先搞了它，结果弄了半天，发现实现我的需求，必须要搞WDS，而这个需要获得房东家路由器的MAC地址不说，还要在人家系统上也更改模式，单纯的AP模式根本不行。下图是它支持的几个模式。
![tomato-wireless-mode.jpg]({{site.baseurl}}/images/tomato-wireless-mode.jpg)

## DD-WRT
进入正题，这个系统刷上了，才知道人家第一不是没有道理的，界面弄的跟商业产品似的，文档极其详细，论坛极其活跃，回答极其详尽。能免费使用功能这么强大产品，感谢，感恩。

### 刷机
刷机和Tomato基本一样，首先到[这里查找到你路由器型号对应的固件，然后下载](https://www.dd-wrt.com/site/support/router-database)。注意，对于我这款路由器，好像需要先刷一个mini版，然后可以刷其他版本。然后遵循[30-30-30硬刷规则](https://www.dd-wrt.com/wiki/index.php/Hard_reset_or_30/30/30)，我拿了个用来捅手机SIM卡的针来通E3200屁股，每次都要90秒，我去，不容易。 

### 配置
用网线直接连接路由器，浏览器192.168.1.1进入，默认用户名密码是root/admin。然后你就可以根据[这个帖子](https://www.dd-wrt.com/wiki/index.php/Repeater)进行配置无线中继（repeator）了。基本上就是以下三步：

第一，无线基本配置
![wireless1.JPG]({{site.baseurl}}/images/wireless1.JPG)
注意其中的Wireless Network Mode要和主路由器的一致。

第二，无线安全配置
![wireless2.JPG]({{site.baseurl}}/images/wireless2.JPG)
注意副路由器的安全配置要和主路由器的安全配置要保持一致，网站上甚至建议连密码都一样，我没有试过不一样行不行。也就是说 Security Mode, WPA Algorithms 以及密码都是一样的。

第三，基本网络配置
![routerIp.JPG]({{site.baseurl}}/images/routerIp.JPG)
由于我们使用的是中继模式，不是中继桥接，所以，要用不同的网段，如果主路由器是192.168.1.1,你就可以把路由器的ip设置成192.168.2.x，当然换成其他数字也没什么问题。由于DHCP还有，以后你可以通过你设置的路由器地址来访问以及维护。

DD-WRT是好很牛的基于Linux的操作系统，听说有很多有点，以后慢慢发掘吧。
